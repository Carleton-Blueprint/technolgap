---
import EventGrid from "../../../components/EventGrid.astro";
import Subheading from "../../../components/Subheading.astro";
import PageLayout from "../../../layouts/PageLayout.astro";
import { createClient } from "contentful";
import type {Entry} from "contentful";

const client = createClient({
  space: "33d3d7kdmbg5",
  accessToken: "00BZSByF4Gmh1S-vDtMfsmOLIdqrC8fyV404sOfIwzM",
});

// Define the event fields interface
interface EventInterface {
  fields: {
    eventName: string;
    poster: {
      metadata: { tags: [] };
      sys: object;
      fields: {
        title: string;
        description: string;
        file: {
          url: string;
          details: [object];
          fileName: string;
          contentType: string;
        };
      };
    };
    date: string; // Ensure date is expected to be a string
    venue: string;
    eventType: string;
    eventSummary: string;
    time: string | undefined;
    registrationLink: string | undefined;
  };
  contentTypeId: "event";
}

type Events = Entry<EventInterface>[];


const { event_id } = Astro.params;

// Fetch the specific event's details using the eventId
const event = await (async () => {
  try {
    const response = await client.getEntry(event_id);
    return response.fields;
  } catch (err) {
    console.error("Error fetching event details:", err);
    return null;
  }
})();

// Define getStaticPaths to generate the paths for each event
export async function getStaticPaths() {
  try {
    const response = await client.getEntries({ content_type: "event" });
    return response.items.map((event) => ({
      params: { event_id: event.sys.id },
    }));
  } catch (err) {
    console.error("Error fetching events for static paths:", err);
    return [];
  }
}

---

<PageLayout title={event?.eventName}>
    <div class="container">
        <Subheading title={event?.eventName} />
        <EventGrid events={event?.subEvents as Events}/>
    </div>
</PageLayout>

<script>
  document.querySelector("main")?.classList.add("classic-bg")
</script>

<style>

    .container {
        justify-items: center;
        padding-top: 70px;
        min-height: 100vh;
    }
</style>